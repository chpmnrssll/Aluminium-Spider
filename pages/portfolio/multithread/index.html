<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Multithreaded Downloader | VuePress Portfolio Site</title>
    <meta name="description" content="VuePress + GitHub Pages + Travis-CI">
    
    
    <link rel="preload" href="/vuepress/assets/css/0.styles.1df8a5ce.css" as="style"><link rel="preload" href="/vuepress/assets/js/app.5772dd30.js" as="script"><link rel="preload" href="/vuepress/assets/js/12.f3300cc1.js" as="script"><link rel="prefetch" href="/vuepress/assets/js/10.e8d7b044.js"><link rel="prefetch" href="/vuepress/assets/js/11.60e4a584.js"><link rel="prefetch" href="/vuepress/assets/js/13.8b6233c1.js"><link rel="prefetch" href="/vuepress/assets/js/14.c1235418.js"><link rel="prefetch" href="/vuepress/assets/js/2.f8fef2c4.js"><link rel="prefetch" href="/vuepress/assets/js/3.c775113e.js"><link rel="prefetch" href="/vuepress/assets/js/4.1b8fd4c5.js"><link rel="prefetch" href="/vuepress/assets/js/5.751e003d.js"><link rel="prefetch" href="/vuepress/assets/js/6.484655cd.js"><link rel="prefetch" href="/vuepress/assets/js/7.ed392fc7.js"><link rel="prefetch" href="/vuepress/assets/js/8.0a057a64.js"><link rel="prefetch" href="/vuepress/assets/js/9.1ec1fdb8.js">
    <link rel="stylesheet" href="/vuepress/assets/css/0.styles.1df8a5ce.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><div class="page" data-v-8f8510e0><header class="header" data-v-8f8510e0><section class="background" data-v-8f8510e0><video data-src="/vuepress/assets/backgrounds/servers.mp4" poster="/vuepress/assets/backgrounds/serversPoster.jpg" autoplay="autoplay" loop="loop" muted="muted" playsinline class="hero lazyLoad" data-v-8f8510e0></video></section> <section class="foreground" data-v-8f8510e0><h1 class="title" data-v-8f8510e0>
        Multithreaded Downloader
      </h1> <div class="tagline" data-v-8f8510e0>
        Using HTTP Range Requests
      </div></section></header> <div class="content content" data-v-8f8510e0><p>A browser based multi-threaded downloader implemented in vanilla JavaScript.</p> <p>Fetches parts of a file using the HTTP Range header and downloads
those pieces in parallel. When the pieces have all been downloaded, the
original file is re-assembled and saved in the browser's Downloads folder.</p> <p></p><div class="table-of-contents"><ul><li><a href="#requirements">Requirements</a></li><li><a href="#methods">Methods</a><ul><li><a href="#a-download">a[download]</a></li><li><a href="#streamsaver-js">StreamSaver.js</a></li><li><a href="#html5-filesystem-api">HTML5 FileSystem API</a></li></ul></li><li><a href="#usage">Usage</a><ul><li><a href="#constructor">Constructor</a></li><li><a href="#callbacks">Callbacks</a></li></ul></li><li><a href="#demo">Demo</a></li><li><a href="#source">Source</a></li><li><a href="#reference">Reference</a></li></ul></div><p></p> <h2 id="requirements"><a href="#requirements" aria-hidden="true" class="header-anchor">#</a> Requirements</h2> <p>The downloader should fetch the file directly from the web browser without a
server needed to proxy the file. The download process should not need any
client software or browser plugin to be installed. It should allow for resuming
an interrupted download, or at least retrying a part of the file that was
interrupted.</p> <p>This project will allow us to specify the number of download threads and the
size of each request... so we can tune it for specific network conditions, if
that is necessary.</p> <ul><li>Sends HTTP HEAD request to get the file info and calculate number of chunks</li> <li>Sends HTTP GET requests with &quot;Range: bytes=start-end&quot; header for each chunk</li> <li>Monitor the progress of each response stream</li></ul> <p>100% client side JavaScript, no plug-ins or proxy required</p> <h2 id="methods"><a href="#methods" aria-hidden="true" class="header-anchor">#</a> Methods</h2> <h3 id="a-download"><a href="#a-download" aria-hidden="true" class="header-anchor">#</a> a[download]</h3> <ul><li>WhatWG Web Streams</li> <li>Memory limit</li> <li>Blob</li></ul> <h3 id="streamsaver-js"><a href="#streamsaver-js" aria-hidden="true" class="header-anchor">#</a> StreamSaver.js</h3> <ul><li>Uses <a href="https://github.com/jimmywarting/StreamSaver.js" target="_blank" rel="noopener noreferrer">StreamSaver.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to simplify downloading the output stream.</li> <li>Concatenates each response stream (in order) into a final output stream</li> <li>Cross-origin dependency (mitm.html)</li> <li>Service worker timeout</li> <li>WhatWG Web Streams</li> <li><a href="https://github.com/creatorrr/web-streams-polyfill" target="_blank" rel="noopener noreferrer">Web Streams Polyfill<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h3 id="html5-filesystem-api"><a href="#html5-filesystem-api" aria-hidden="true" class="header-anchor">#</a> HTML5 FileSystem API</h3> <ul><li>Uses <a href="https://github.com/vitalets/bro-fs" target="_blank" rel="noopener noreferrer">Bro-fs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> (HTML5 Filesystem api) to temporarily save each chunk.</li> <li>Concatenates all chunks once complete and triggers a[download] with final file.</li> <li>HTML5 Filesystem is marked deprecated but is still commonly in use.</li></ul> <h2 id="usage"><a href="#usage" aria-hidden="true" class="header-anchor">#</a> Usage</h2> <h3 id="constructor"><a href="#constructor" aria-hidden="true" class="header-anchor">#</a> Constructor</h3> <p>The Multithread constructor accepts a single object parameter:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">MultiThread</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  url<span class="token punctuation">:</span> <span class="token string">'http://some-url/'</span><span class="token punctuation">,</span>    <span class="token comment">// The request url</span>
  headers<span class="token punctuation">:</span> <span class="token punctuation">{</span>                  <span class="token comment">// Request headers to pass-though</span>
    <span class="token string">'Authorization'</span><span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`Bearer </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>accessToken<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  fileName<span class="token punctuation">:</span> <span class="token string">'some-file.ext'</span><span class="token punctuation">,</span>  <span class="token comment">// The final output fileName</span>
  chunkSize<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>               <span class="token comment">// Size of each chunk in MB</span>
  threads<span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span>                 <span class="token comment">// Number of concurrent request threads</span>
  retries<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>                 <span class="token comment">// Number of retry attempts</span>
  retryDelay<span class="token punctuation">:</span> <span class="token number">1000</span>            <span class="token comment">// Delay before another retry attempt in ms</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="callbacks"><a href="#callbacks" aria-hidden="true" class="header-anchor">#</a> Callbacks</h3> <p>Multithread triggers several events that you can attach callbacks to. The
callbacks will be called with a single object consisting of the following keys:</p> <ul><li>onStart({ contentLength, chunks })</li> <li>onFinish({})</li> <li>onProgress({ contentLength, loaded })</li> <li>onError({ error })</li></ul> <p>Each individual chunk will also trigger it's own events:</p> <ul><li>onChunkStart({ id })</li> <li>onChunkFinish({ id })</li> <li>onChunkProgress({ contentLength, loaded, id })</li> <li>onChunkError({ id, error })</li></ul> <p>PromiseQueue provides concurrency by using a queue of promises. It will
automatically retry a configurable amount of times before triggering either an
&quot;onFinish&quot; or &quot;onError&quot; event.</p> <h2 id="demo"><a href="#demo" aria-hidden="true" class="header-anchor">#</a> Demo</h2> <a href="https://backblaze-b2-samples.github.io/multithreaded-downloader-js/examples/backblaze.html"><img data-src="/vuepress/assets/backblazeB2.png" alt="Backblaze B2" class="lazyLoad tiny"></a> <a href="https://backblaze-b2-samples.github.io/multithreaded-downloader-js/examples/googleDrive.html"><img data-src="/vuepress/assets/googleDrive.jpg" alt="Google Drive" class="lazyLoad tiny"></a> <h2 id="source"><a href="#source" aria-hidden="true" class="header-anchor">#</a> Source</h2> <a href="https://github.com/Backblaze-B2-Samples/multithreaded-downloader-js"><img data-src="/vuepress/assets/logo/logoGithub.png" alt="Github" class="lazyLoad tiny"></a> <h2 id="reference"><a href="#reference" aria-hidden="true" class="header-anchor">#</a> Reference</h2> <ul><li><a href="https://blog.ghaiklor.com/parallel-chunk-requests-in-a-browser-via-service-workers-7be10be2b75f" target="_blank" rel="noopener noreferrer">Parallel chunk requests in a browser via Service Workers<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Streams_API" target="_blank" rel="noopener noreferrer">Web Streams API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://streams.spec.whatwg.org/" target="_blank" rel="noopener noreferrer">Web Streams Spec<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/mafintosh/browser-server" target="_blank" rel="noopener noreferrer">browser-server<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/jonbern/fetch-retry" target="_blank" rel="noopener noreferrer">fetch-retry<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://pipes.js.org/" target="_blank" rel="noopener noreferrer">Pipes.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <footer class="footer" data-v-8f8510e0><div class="meta" data-v-8f8510e0><span class="lastUpdated" data-v-8f8510e0>
        Monday, August 27, 2018
      </span> <span class="tags" data-v-8f8510e0><span data-v-8f8510e0>Tags: </span> <span data-v-8f8510e0>Featured </span><span data-v-8f8510e0>Javascript </span><span data-v-8f8510e0>Async </span><span data-v-8f8510e0>WhatWG Streams </span></span></div> <div class="text" data-v-8f8510e0>Copyright © 2018-present Russell Chapman</div></footer> </div></div></div>
    <script src="/vuepress/assets/js/app.5772dd30.js" defer></script><script src="/vuepress/assets/js/12.f3300cc1.js" defer></script>
  </body>
</html>
